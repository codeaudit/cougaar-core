2002-06-21  Ray Tomlinson  <RTomlinson@bbn.com>

	* FilePersistence.java:
	Bug #1551 Directory creation race
	Unconditionally call mkdirs to create the path to the persistence
	root directory. Then verify that it exists and throw an exception
	if it does not. The cost of calling mkdirs when it's not needed is
	miniscule.

	* BasePersistence.java:
	Bug #1536 -- NotPersistable object are persisted
	Revise copyAndRemoveNotPersistable to actually remove
	EnvelopeTuples for not persistable objects. Copies of Envelopes
	having such tuples are created without the not persistable
	objects. Use copyAndRemoveNotPersistable to filter not persistable
	objects out of pendingEnvelopes and transactionEnvelopes of
	PersistenceSubscriberState.
	
	* BasePersistence.java:
	Bug #1539 -- Publishable.isPersistable is ignored
	The isPersistable test now covers both NotPersistable objects and
	Publishable objects for which the isPersistable method return
	false.

	* NotPersistable.java:
	Bug #1537
	Fix javadoc to more accurately describe this marker interface.

2002-06-18  Ray Tomlinson  <RTomlinson@bbn.com>

	* BasePersistence.java:
	Bug #1511
	Rehydration sets are reversed preferring oldest over newest.
	Reversed to the sign of the comparisons to fix.
	

2002-06-14  Ray Tomlinson  <RTomlinson@bbn.com>

	* PersistencePlugin.java:
	Add methods to support DataProtectionService.
	storeDataProtectionKey stores the encrypted key and
	retrieveDataProtectionKey retrieves it.

	* FilePersistence.java: 
	Implement additional methods to support DataProtectionService.
	The keys are stored in files named key_<delta number>.
	
	* DummyPersistence.java:
	Implement additional methods to support DataProtectionService.

	* DatabasePersistence.java:
	Define methods for using DataProtectionService, but implementation
	just throws an exception -- that is, DataProtectionService cannot
	presently be used with a Database persistence medium.

	* BasePersistence.java:
	Add DataProtectionService. Implement DataProtectionServiceClient.
	Use DataProtection Service to wrap input and output streams.

2002-05-09  Ray Tomlinson  <RTomlinson@bbn.com>

	* BasePersistence.java:
	Re-interpret "disabled persistence" as install only the dummy
	persistence plugin and run persistence at a minimal rate. This
	leaves the persistence mechanism available for getting agent state
	for agent mobility.

2002-05-07  Ray Tomlinson  <RTomlinson@bbn.com>

	* FilePersistence.java:
	Default persistenct root directory to <org.cougaar.workspace>/P
	Default <org.cougaar.workspace> to <org.cougaar.install.path>/workspace

2002-04-29  Ray Tomlinson  <RTomlinson@bbn.com>

	* FilePersistence.java:
	Add documentation of initialization parameters.

	* BasePersistence.java:
	Fix documentation of org.cougaar.core.persistence.class to
	correspond to use for multiple plugins.

2002-04-26  Ray Tomlinson  <RTomlinson@bbn.com>

	* BasePersistence.java:
	Insure that the currentPersistPluginInfo is never null while
	persisting.

2002-04-23  Ray Tomlinson  <RTomlinson@bbn.com>

	* BasePersistence.java:
	Move the "finally" clause from rehydrateFromStream to the caller
	(rehydrateOneDelta) where access to the correct persistence plugin
	is possible.

2002-04-19  Ray Tomlinson  <RTomlinson@bbn.com>

	* PersistenceControlPlugin.java:
	Plugin to control persistence. Interrogates the persistence
	service for all controls and creates OperatingModes for those
	controls. Then monitors the OperatingModes and adjusts the
	controls accordingly.

	* PersistencePluginAdapter.java:
	Adapter for PersistencePlugin implementations defining default
	implementations of several methods that seldom need to be tailored
	by the plugin. This methods include the new methods for specifying
	media-specific controls.

	* PersistencePlugin.java:
	Add methods for media-specific controls (OperatingModes)

	* FilePersistence.java: 
	* DummyPersistence.java: 
	* DatabasePersistence.java:
	Used PersistencePluginAdapter for common functions.

2002-04-10  Ray Tomlinson  <RTomlinson@bbn.com>

	* SequenceNumbers.java: 
	* PersistencePlugin.java: 
	* PersistenceOutputStream.java: 
	* Persistence.java: 
	* FilePersistence.java: 
	* DummyPersistence.java: 
	* DatabasePersistence.java: 
	* BasePersistence.java:
	Changes to support persistence adaptivity.

2002-03-11  Ray Tomlinson  <RTomlinson@bbn.com>

	* PersistencePlugin.java:
	Add class javadoc.

2002-03-08  Ray Tomlinson  <RTomlinson@bbn.com>

	* SequenceNumbers.java:
	* PersistencePluginSupport.java:
	* PersistencePlugin.java: 
	* FilePersistence.java:
	* DummyPersistence.java: 
	* DatabasePersistence.java:
	* BasePersistence.java:
	Obtain media-specific services using PersistencePlugin
	implementations instead of sub-classing BasePersistence. Basic
	operation has not changed only refactored.
	Convert to using LoggingService instead of writing history and
	other files.

2002-01-24  Ray Tomlinson  <RTomlinson@bbn.com>

	* DatabasePersistence.java:
	Fix bug 1014
	The query to update the status of incremental deltas in the
	database was being overwritten with the query to update the status
	of full deltas so incremental deltas remained active forever and
	were never scavenged. Also the argument specifying if a delta were
	full or not was misspelled and so no delta was ever marked as
	"full". Consequently, all deltas were incremental and never
	scavenged.
	There was no provision to scavenge full deltas when archiving is
	disabled. This now fixed so the persistence database can be kept
	as trim as possible.

	* BasePersistence.java:
	Fix bug 1014
	Document clear property
	Add org.cougaar.core.cluster.persistence.archivingDisabled
	property to allow archiving to be disabled.
	Add org.cougaar.core.cluster.persistence.consolidationPeriod
	property to control how ofter full deltas are generated. Defaults
	to 10 which it is the prior hard-coded value

2001-11-16  Ray Tomlinson  <RTomlinson@bbn.com>

	* Persistence.java: 
	* FilePersistence.java: 
	* DummyPersistence.java:
	Add getDatabaseConnection and releaseDatabaseConnection to
	Persistence interface for use by Delta. This avoids casting the
	Persistence interface into a DatabasePersistence in order to
	access these methods. The methods throw
	UnsupportedOperationException in the non-database implementations
	of this interface.

2001-09-27  Ray Tomlinson  <RTomlinson@bbn.com>

	* PersistenceException.java (Repository):
	Add a little javadoc.

2001-08-31  Ray Tomlinson  <RTomlinson@bbn.com>

	* Persistence.java: 
	* FilePersistence.java: 
	* DummyPersistence.java: 
	* DatabasePersistence.java: 
	* BasePersistence.java:
	Add suffix argument to disableWrite and readSequenceNumbers
	methods to allow arbitrary archive to be specified from the
	command line. In the case of DatabasePersistence, the suffix is
	parsed into its numeric value and used to query for the correct
	archive delta.

2001-08-30  Ray Tomlinson  <RTomlinson@bbn.com>

	* Persistence.java: 
	* FilePersistence.java: 
	* DummyPersistence.java: 
	* DatabasePersistence.java: 
	* BasePersistence.java:
	Change interface to permit full versus incremental persistence.
	Retain full persistence deltas for archiving. Also make an extra
	copy of the sequence file for each full delta. This facilitates
	returning to archived data.

2001-08-24  Ray Tomlinson  <RTomlinson@bbn.com>

	* BasePersistence.java:
	Remove clusters List, it's not needed and it holds onto old
	clusters after they have been moved elsewhere.

2001-08-13  Ray Tomlinson  <rtomlinson@bbn.com>

	* RehydrationResult.java:
	Used to pass back the MessageManager after rehydration in addition
	to the old return result. The MessageManager is not managed by the
	persistence module any more. See BasePersistence.

	* PersistenceOutputStream.java:
	Add accessor to get the bytes of the output stream. Used to
	provide the object needed to implement getState().

	* PersistenceObject.java:
	A wrapper around a byte array of serialized persistence
	information. Used to implement the component getState methods.

	* PersistenceNotEnabledException.java:
	An exception to throw when an operation requires persistence to
	be enabled and it isn't.	

	* Persistence.java:
	Change interface to pass additional information in and out when
	performing persistence. See BasePersistence for details.

	* BasePersistence.java:
	Move management of MessageManager out of this class. It is now
	only a special object needing persistence (if present at all). Add
	rehydration from a PersistenceObject object containing a byte
	array of serialized persistence info. Intended for use with
	dynamic agents to rehydrate an agent at a new location. Also, on
	the other side, return said PersistenceObject when creating a
	persistence delta, if requested.

1999-07-13  Ray Tomlinson  <rtomlinson@bbn.com>

	* ChangeLog -- created

	* Persistence.java Persistence interface.

	* FilePersistence.java Implementation of Persistence using files.

	* IdentityTable.java Augmented Hashtable to maintain
	correspondence between persisted objects and indentifying
	integers.

	* NonPersistable.java Marker interface for objects that should not
	be persisted.

	* NotPersistableException.java Exception thrown by attempts to
	persist objects that can't be persisted.

	* PersistenceAssociation.java Associates a reference int and a
	persistable object.

	* PersistenceInputStream.java ObjectInputStream subclass to
	implement persistence.

	* PersistenceOutputStream.java ObjectOutputStream subclass to
	implement persistence.
	
	* PersistenceReference.java Replacement for previously persisted
	objects.

	* PersistenceSubscriberState.java Named container for the inbox	of
	a Subscriber.
